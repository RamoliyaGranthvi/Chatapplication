<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat with {{ other_user[1] }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Chat with {{ other_user[1] }}</h1>

    <!-- Chat Box -->
    <div id="chat-box">
        {% if room in rooms %}
            {% for message in rooms[room]["messages"] %}
                <p><strong>{{ message.name }}:</strong> {{ message.message }}</p>
            {% endfor %}
        {% else %}
            <p>No messages yet. Start chatting!</p>
        {% endif %}
    </div>

    <!-- Message Input -->
    <form id="message-form">
        <input type="text" id="message" placeholder="Type your message..." required>
        <button type="submit">Send</button>
    </form>

    <!-- Socket.io JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        // Join the chat room
        socket.emit('join', {{ room | tojson }});

        // Handle message sending
        document.getElementById("message-form").addEventListener("submit", function(event) {
            event.preventDefault();
            var message = document.getElementById("message").value;
            socket.emit('message', {message: message});
            document.getElementById("message").value = '';  // Clear input field
        });

        // Display incoming messages
        socket.on('message', function(data) {
            var chatBox = document.getElementById("chat-box");
            chatBox.innerHTML += "<p><strong>" + data.name + ":</strong> " + data.message + "</p>";
            chatBox.scrollTop = chatBox.scrollHeight;  // Scroll to bottom
        });
    </script>
</body>
</html>
